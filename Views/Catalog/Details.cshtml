@model freak_store.Models.Product

@{
    ViewBag.Title = "Detalles del Producto";
}

<h2>@Model.Name</h2>

<div>
    <img src="@Model.Img" alt="@Model.Name" style="width: 100%; max-width: 400px;" />
    <p><strong>Descripción:</strong> @Model.Description</p>
    <p><strong>Precio:</strong> $@Model.Price</p>

    @if (Model.Discount != null)
    {
        <p><strong>Descuento:</strong> @Model.Discount.Percentage %</p>
    }

    <p><strong>Categoría:</strong> @Model.Category.Name</p>
    <p><strong>Disponibilidad:</strong> @Model.Inventory.Quantity en stock</p>

    <form id="add-to-cart-form" method="post" action="/ShoppingCart/AddToCart">
        <input type="hidden" name="productId" value="@Model.Id" />
        <label for="quantity">Cantidad:</label>
        <input type="number" name="quantity" id="quantity" value="1" min="1" />

        <button type="submit" class="btn btn-primary">Añadir al carrito</button>
    </form>

    <div id="confirmation-message" style="display:none; color: green; margin-top: 10px;">
        Producto añadido al carrito con éxito.
    </div>
</div>

<script>
    document.getElementById("add-to-cart-form").addEventListener("submit", function(event) {
        event.preventDefault(); // Evita la redirección

        const form = event.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: "POST",
            body: formData,
            headers: {
                "X-Requested-With": "XMLHttpRequest"
            }
        })
        .then(response => {
            if (response.ok) {
                document.getElementById("confirmation-message").style.display = "block";
                setTimeout(() => {
                    document.getElementById("confirmation-message").style.display = "none";
                }, 3000); // Esconde el mensaje después de 3 segundos
            } else {
                alert("Hubo un error al añadir el producto al carrito.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Hubo un error al añadir el producto al carrito.");
        });
    });
</script>
